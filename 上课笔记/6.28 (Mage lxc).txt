6.28 (Mage lxc)


lxc: linux 

cgroups
namespace

支持在一个内核空间，支持多个用户空间(拥有单独的各自信息)


需要的安装包：
	$ yum install lxc lxc-templates


构建多种网络环境：
	容器：
		$ yum info lxc    --> linux container
			在一个内核上运行多个用户空间 --> 各个用户空间都是相互隔离的


lxc命令：

	'模板文件：'
		/usr/share/lxc/templates/lxc-centos

		修改其中[base]的baseurl信息为我们本地的yum仓库
		baseurl=http://172.16.0.1/cobbler/ks_mirror/CentOS-7-1511-x86_64/

		把[update]设置成 enabled=0
	
	'创建一个容器：'
		$ lxc-create -t centos -n node1    --> 创建容器
		会根据模板文件的配置来生成一个 minimal linux 



	启动容器：
		$ lxc-start -n node1 
			-n：指定名字
			-F：前台运行
			-d：后台运行


	快照：
		$ lcx-snapshot 

	克隆：
		$ lcx-clone





部署一个lxc虚拟机：
	1、安装lxc以及模板 lxc-templates
		$ yum install -y lxc lxc-templates

	2、修改网卡信息，并拷贝网卡配置文件
		$ cd /etc/sysconfig/network-scripts/
		$ cp ifcfg-eno16777736 ifcfg-virbr0
		$ vim ifcfg-virbr0
		$ cat /etc/sysconfig/network-scripts/ifcfg-eth0
		# Generated by dracut initrd
		NAME="eth0"
		DEVICE=eth0
		HWADDR=00:1C:42:9D:9F:3A
		ONBOOT=yes
		NETBOOT=yes
		UUID="5170999c-4e31-46af-8cc6-8069916d3f7b"
		IPV6INIT=yes
		BOOTPROTO=none
		TYPE=Ethernet
		BRIDGE=virbr0 				'添加要桥接到哪个设备上'
		#DEFROUTE=yes
		#IPV4_FAILURE_FATAL=no
		#PEERDNS=yes
		#IPADDR=172.16.1.70
		#PREFIX=16
		#GATEWAY=172.16.0.1
		
		[root@test-2 ~]# cat /etc/sysconfig/network-scripts/ifcfg-virbr0
		# Generated by dracut initrd
		NAME="eth0"
		DEVICE=virbr0 					'这里如果配置文件中没有DEVICE一项，则需要自己添加，只修改这里的名字即可，无需修改NAME'
		#HWADDR=00:1C:42:9D:9F:3A
		ONBOOT=yes
		NETBOOT=yes
		BOOTPROTO=none 
		TYPE=Bridge  					'设置网卡类型为桥接'
		IPV4_FAILURE_FATAL=no
		PEERDNS=yes
		IPADDR=172.16.1.70
		PREFIX=16
		GATEWAY=172.16.0.1

		$ systemctl restart network


	3、修改模板文件：
		$ vim /usr/share/lxc/templates/lxc-centos
		[base]
		name=CentOS-$release - Base
		#mirrorlist=http://mirrorlist.centos.org/?release=$release&arch=$basearch&repo=os
		baseurl=http://172.16.0.1/cobbler/ks_mirror/CentOS-7-1511-x86_64/

		[updates]
		name=CentOS-$release - Updates
		mirrorlist=http://mirrorlist.centos.org/?release=$release&arch=$basearch&repo=updates
		enabled=0

	4、创建模板
		$ lxc-create -n node1 -t centos

	5、修改node1密码：
		$ chroot /var/lib/lxc/node1/rootfs passwd

	6、查看状态：
		$ lxc-info -n node1
		Name:           node1
		State:          STOPPED

	7、启动
		$ lxc-start -n node1

	8、输入密码即可登录





































